/* eslint-disable */
import{createElementNS as t,SVG_NS as e,Timer as o,UiComponent as r}from"@jusfoun-vis/common";import{select as i,arc as n,scaleLinear as a}from"d3";function s(t,e){for(var o,r=0;r<e.length;r++)(o=e[r]).enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}function u(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var c=50;export default(function(r){var h=Math.PI;function f(){var o;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,f),o=function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?d(t):e}(this,l(f).call(this)),u(d(o),"_value",c),u(d(o),"_fontSize",12),u(d(o),"_fontColor","#fff"),u(d(o),"_width",void 0),u(d(o),"_height",void 0),u(d(o),"_speed",.5),u(d(o),"_peak",5),u(d(o),"_stopColor",void 0),u(d(o),"_borderStopColor",void 0),u(d(o),"_borderWidth",void 0),u(d(o),"isUpdateSize",!1),u(d(o),"isUpdateValue",!1),u(d(o),"isUpdateBallStopColor",!1),u(d(o),"isUpdateBorderStopColor",!1),u(d(o),"isUpdateTextStopColor",!1);var r=d(o);r._domElement=t(e,"svg");var a=i(r._domElement),s=a.append("g"),p=a.append("text");return r._border=a.append("path"),r._ball=s.append("path"),r._arc=n(),r._svg=a,r._ballGroup=s,r._text=p,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(f,r),function(t,e,o){e&&s(t.prototype,e),o&&s(t,o)}(f,[{key:"updateSize",value:function(){this.isUpdateSize=!0,this.invalidateProperties()}},{key:"updateValue",value:function(){this.isUpdateValue=!0,this.invalidateProperties()}},{key:"updateBallStopColor",value:function(){this.isUpdateBallStopColor=!0,this.invalidateProperties()}},{key:"UpdateBorderStopColor",value:function(){this.isUpdateBorderStopColor=!0,this.invalidateProperties()}},{key:"UpdateTextStopColor",value:function(){this.isUpdateTextStopColor=!0,this.invalidateProperties()}},{key:"linearGradient",value:function(t){for(var e=this.svg,o=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,t)}(),r=e.append("defs").append("linearGradient").attr("id",o).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),i=0;i<t.length;i++)r.append("stop").attr("offset",100*i+"%").style("stop-color",t[i]);return"#"+o}},{key:"getPath",value:function(){for(var t=Math.sin,e=this,o=2*e.width,r=a().range([0,o]).domain([0,720]),i=[],n=0;n<721;n++){var s=t(n*h/180)*e.peak,u=(1-e.value/100)*e.height+s,l=r(n);0==n?i.push("M".concat(l,",").concat(u," ")):i.push("L".concat(l,",").concat(u," "))}return i.concat(["L".concat(o,",").concat(e.height," "),"L0,".concat(e.height," Z")]).join("")}},{key:"commitProperties",value:function(){var t=this,e=t.domElement.style,r=t.ballGroup,i=t.border,n=t.ball,a=t._arc,s="",u=t.text;if(t.isUpdateBallStopColor){t.isUpdateBallStopColor=!1;var l;l=Array.isArray(t.fontColor)?"url(".concat(t.linearGradient(t.stopColor),")"):t.stopColor,n.attr("fill",l)}if(t.isUpdateBorderStopColor){t.isUpdateBorderStopColor=!1;var p;p=Array.isArray(t.fontColor)?"url(".concat(t.linearGradient(t.borderStopColor),")"):t.borderStopColor,i.attr("fill",p)}if(t.isUpdateTextStopColor){t.isUpdateTextStopColor=!1;var d;d=Array.isArray(t.fontColor)?"url(".concat(t.linearGradient(t.fontColor),")"):t.fontColor,u.attr("fill",d)}if(t.isUpdateSize){t.isUpdateSize=!1;var c=t.radius;e.width=t.width,e.height=t.height,e.borderRadius=c+"px";var f=2*t.width;r.attr("transform","translate(".concat(-f/2," 0)"));var _=-f/2,v=t.speed,y=new o(o.REQUEST_ANIMATION_FRAME);y.on("timer",function(){0<(_+=v)&&(_=-f/2),r.attr("transform","translate(".concat(_," 0)"))}),y.start();var g=a.outerRadius(t.radius).innerRadius(t.radius-t.borderWidth).startAngle(0).endAngle(2*h);i.attr("transform","translate(".concat(t.radius," ").concat(t.radius,")")).attr("d",g())}t.isUpdateValue&&(t.isUpdateValue=!1,s=t.getPath(),n.attr("stroke-width",0).transition().duration(1e3).attr("d",s))}},{key:"text",get:function(){return this._text}},{key:"ball",get:function(){return this._ball}},{key:"svg",get:function(){return this._svg}},{key:"ballGroup",get:function(){return this._ballGroup}},{key:"border",get:function(){return this._border}},{key:"domElement",get:function(){return this._domElement}},{key:"value",get:function(){return this._value},set:function(t){this._value=t,this.updateValue()}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize=t,this.updateValue()}},{key:"fontColor",get:function(){return this._fontColor},set:function(t){this._fontColor=t,this.UpdateTextStopColor()}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this.updateSize()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this.updateSize()}},{key:"speed",get:function(){return this._speed},set:function(t){this._speed=t,this.updateSize()}},{key:"peak",get:function(){return this._peak},set:function(t){this._peak=t,this.updateSize()}},{key:"stopColor",get:function(){return this._stopColor},set:function(t){this._stopColor=t,this.updateBallStopColor()}},{key:"borderStopColor",get:function(){return this._borderStopColor},set:function(t){this._borderStopColor=t,this.UpdateBorderStopColor()}},{key:"borderWidth",get:function(){return this._borderWidth},set:function(t){this._borderWidth=t,this.UpdateBorderStopColor()}},{key:"radius",get:function(){return(0,Math.min)(this.width,this.height)/2}}]),f}(r));
