/* eslint-disable*/
import t,{Component as e,createRef as n}from"react";import"@jusfoun-vis/canvas-common";import{select as i,event as a,easeLinear as r,interpolate as o}from"d3";import{createElement as l,Timer as c,setStyles as s,UiComponent as u}from"@jusfoun-vis/common";import{SphereBufferGeometry as v,MeshBasicMaterial as f,TextureLoader as d,Mesh as p}from"three";import{General3DEnv as m}from"@jusfoun-vis/threejs-chart";
import Image_sphere from './images/sphere-01.png';
import './css/RotateIcon.css';
function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n,i=0;i<e.length;i++)(n=e[i]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}function y(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function k(t){for(var e=1;e<arguments.length;e++){var n=null==arguments[e]?{}:arguments[e],i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){g(t,e,n[e])})}return t}function b(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function S(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?x(t):e}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,a=!1,r=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){a=!0,r=t}finally{try{i||null==l.return||l.return()}finally{if(a)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function C(t){return function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var P=function(e){function n(){var t,e;_(this,n);for(var i=arguments.length,a=Array(i),r=0;r<i;r++)a[r]=arguments[r];return g(x(e=S(this,(t=A(n)).call.apply(t,[this].concat(a)))),"_measureTextWidth",function(t,e){var n=document.createElement("canvas").getContext("2d");return n.font=e,t+="",n.measureText(t).width}),e}return b(n,t.Component),y(n,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){var e=this,n=e.props.style;return t.createElement("canvas",{style:k({},n,{display:"inline-block"}),ref:function(t){return e._canvas=t}})}},{key:"componentDidMount",value:function(){var t=this,e=t.props,n=e.textStyle,i=void 0===n?{}:n,a=e.text,r=t._canvas,o=i.colors,l=void 0===o?["#ffffff","#2489f3"]:o,c=i.fontSize,s=void 0===c?20:c,u="bold ".concat(s,"px Microsoft YaHei"),v=r.getContext("2d"),f=t._measureTextWidth(a,u);r.width=f,r.height=1.2*s,r.setAttribute("title",a),r.setAttribute("alt",a);var d=v.createLinearGradient(f/2,0,f/2,s);l.forEach(function(t,e){d.addColorStop(e/(l.length-1),t)}),v.font=u,v.fillStyle=d,v.fillText(a,0,s)}}]),n}(),F=function(){return t.createElement("div",{className:"rotate_component_track_wrapper"},t.createElement("div",{className:"rotate_component_track"},t.createElement("div",{className:"rotate_component_track_point"})))},z=function(e){var n=Math.round;function a(t){var e;_(this,a);var i=x(e=S(this,A(a).call(this,t))),r=n(268435455*Math.random()).toString(16)+Date.now();return i._gradientId="gradient_".concat(r),i._textPathId="textPath_".concat(r),e}return b(a,e),y(a,[{key:"render",value:function(){var e=this;return t.createElement("div",{className:"rotate_component_path_word_root"},t.createElement("svg",{ref:function(t){return e._svg=t},style:{transform:"scale(0.9)"},width:"".concat(675,"px"),height:"".concat(360,"px")},t.createElement("defs",null,t.createElement("linearGradient",{id:e._gradientId,x1:"50%",y1:"0%",x2:"50%",y2:"100%"},t.createElement("stop",{offset:"0%",stopColor:"transparent"}),t.createElement("stop",{offset:"25%",stopColor:"rgb(18, 255, 255)"}),t.createElement("stop",{offset:"100%",stopColor:"rgb(18, 255, 255)"})))))}},{key:"componentDidMount",value:function(){var t=this,e=t.props.wordShow,n=t._svg,a=i(n);if(a.append("path").style("fillRule","evenodd").style("stroke","url(#".concat(t._gradientId,")")).style("stroke-width","2px").style("stroke-linecap","butt").style("stroke-linejoin","miter").style("fill","none").attr("id","".concat(t._textPathId)).attr("transform","translate(105,0) scale(0.9)").attr("d","M 322.950,8.412 \n                  C 468.608,32.570 571.333,109.077 587.214,183.664 \n                  C 604.720,265.884 517.483,334.788 372.555,340.792 \n                  C 190.093,348.351 7.855,252.127 1.675,143.586 \n                  C -4.198,40.429 151.149,-20.082 322.950,8.412 Z"),void 0===e||e){var r=[200,550,900];a.selectAll("text").data(["事前信用承诺","事中分类监管","事后联合奖惩"]).enter().append("text").style("font-size","30px").style("font-weight","500").style("fill","rgb(255, 255, 255)").style("stroke","rgba(18, 255, 255, 0.96)").style("stroke-width","0.5px").attr("rotate",function(t,e){return 1===e?"180":0}).attr("x",function(t,e){return r[e]}).attr("dy",function(t,e){return 1===e?"1em":"-0.35em"}).append("textPath").attr("xlink:href","#".concat(t._textPathId)).text(function(t,e){return 1===e?t.split("").reverse().join(""):t})}}}]),a}(e),D=Math.PI,I=2*D,O=Math.cos,j=Math.sin,T=function(){},M=function(t){var e=t;return t>=I&&(e=t%I),0>=t&&(e=I+t%I),e},H=function(t){return'<div class="label value">'.concat(t.value).concat(t.unit,"</div>")+'<div class="label name">'.concat(t.name,"</div>")},R=function(t){return{value:t.value,unit:t.unit,name:t.name,tipData:t.tipData}},N=function(t){var e=Math.round;function n(){var t;_(this,n),g(x(t=S(this,A(n).call(this))),"_size",[0,0]),g(x(t),"_rotateItemSize",[165,165]),g(x(t),"_rotateItemAngleFix",-15),g(x(t),"_xPoint",void 0),g(x(t),"_yPoint",void 0),g(x(t),"_data",[]),g(x(t),"_stopAngle",I-I/6),g(x(t),"_itemClickHandle",T),g(x(t),"_preActiveFlag",void 0),g(x(t),"_getActiveCallback",T),g(x(t),"_invalidateSizeFlag",!1),g(x(t),"_invalidateDataFlag",!1),g(x(t),"_invalidateStartFlag",!1),g(x(t),"_invalidateStopFlag",!1),g(x(t),"_invalidateDisposeFlag",!1),g(x(t),"_clickInteractive",!0),g(x(t),"_showTip",!0),g(x(t),"_itemSize",[175,175]);var i=x(t),a=e(268435455*Math.random()).toString(16)+Date.now();return i._gradientId="gradient_".concat(a),i.initialize(),t}return b(n,t),y(n,[{key:"initialize",value:function(){var t=this;t._domElement=l("div"),t._domElement.setAttribute("id","rp"+Date.now()),t._timer=new c(c.REQUEST_ANIMATION_FRAME)}},{key:"commitProperties",value:function(){var t=this;t._invalidateDisposeFlag&&(t._invalidateDisposeFlag=!1,t._invalidateSizeFlag=!1,t._invalidateDataFlag=!1,t._invalidateStartFlag=!1,t._invalidateStopFlag=!1,t._timer.off("timer"),t._domElement.innerHTML=""),t._invalidateSizeFlag&&(t._invalidateSizeFlag=!1,s(t._domElement,{position:"absolute",left:0,top:0,width:"100%",height:"100%"}),t._ellipsePoint()),t._invalidateDataFlag&&(t._invalidateDataFlag=!1,t._renderRotateElements(),t._showTip&&t._renderTips()),t._invalidateStopFlag&&(t._invalidateStopFlag=!1,t._timer.stop()),t._invalidateStartFlag&&(t._invalidateStartFlag=!1,t._timer.start())}},{key:"_ellipsePoint",value:function(){var t=this,e=w(t._size.map(function(t){return.5*t}),2),n=e[0],i=e[1],a=w(t._rotateItemSize,2),r=a[0],o=a[1];t._xPoint=function(t){return n+n*O(t)-r/2},t._yPoint=function(t){return i+i*j(t)-o/2}}},{key:"_transformString",value:function(t){var e=this,n=e._rotateItemAngleFix,i=e._xPoint,a=e._yPoint;return"translate3d(".concat(i(t),"px,").concat(a(t),"px,0) \n                rotate(").concat(n,"deg)")}},{key:"_renderRotateElements",value:function(){var t=this,e=i(t._domElement),n=C(t._data),r=I/n.length,o=t._itemSize;n=n.map(function(t,e){return k({angle:e*r},t)});var l=e.selectAll("div.item").data(n);l.enter().append("div").merge(l).attr("class","item").each(function(t){this._currentAngle=t.angle}).classed("active",function(){return t._isActive(this._currentAngle)}).style("width","".concat(o[0],"px")).style("height","".concat(o[1],"px")).style("transform",function(){return t._transformString(this._currentAngle)}).html(H).on("mouseenter",function(){return t._timer.stop()}).on("click",function(e){if(t._clickInteractive&&(a.cancelBubble=!0,t._timer.stop(),1===a.detail)){t._resetAllRotateElementsStyle(),i(this).attr("class","item active"),t._itemClickHandle&&t._itemClickHandle(R(e))}}).on("dblclick",function(){a.cancelBubble=!0}),l.exit().remove(),t._timer.off("timer"),t._timer.on("timer",function(){t._rotateElements(),t._getActiveData()})}},{key:"_renderTips",value:function(){i(this._domElement).selectAll("div.item").each(function(t){var e=t.tipData;if(e){var n=e.length;i(this).append("div").attr("class","tip right").on("click",function(){a.cancelBubble=!0}).html(function(){var t="";if(3<n){var i="";e.forEach(function(e,n){0==n%2?i='<div class="line_part" style="margin-right: 10px;">\n                          <span class="tip_name">'.concat(e.name,'</span>:\n                          <span class="tip_value">').concat(e.value).concat(e.unit,"</span>\n                        </div>"):(i+='<div class="line_part">\n                           <span class="tip_name">'.concat(e.name,'</span>:\n                          <span class="tip_value">').concat(e.value).concat(e.unit,"</span>\n                        </div>"),t+='<div class="line">'.concat(i,"</div> "))})}else e.forEach(function(e){t+='<div class="line">\n                          <span class="tip_name">'.concat(e.name,'</span>:\n                          <span class="tip_value">').concat(e.value).concat(e.unit,"</span>\n                         </div> ")});return'<div class="triangle"></div>'+'<div class="content"><div class="contentContainer">'.concat(t,"</div></div>")})}})}},{key:"_rotateElements",value:function(){var t=this;i(t._domElement).selectAll("div.item").each(function(){var e=this;e._currentAngle+=I/2160,e._currentAngle=M(e._currentAngle),i(e).classed("active",t._isActive(e._currentAngle)).style("transform",function(){return t._transformString(e._currentAngle)})})}},{key:"_isActive",value:function(t){return(0,Math.abs)(t-this._stopAngle)<=D/9}},{key:"_getActiveData",value:function(){var t=this,e=i(t._domElement).selectAll("div.item").filter(function(){return t._isActive(this._currentAngle)}).data()[0];e&&t._preActiveFlag!==e.name&&(t._preActiveFlag=e.name,t._getActiveCallback&&t._getActiveCallback(R(e)))}},{key:"_resetAllRotateElementsStyle",value:function(){i(this._domElement).selectAll("div.item").attr("class","item normal")}},{key:"_rotateElementsByOffset",value:function(t){var e=this;i(e._domElement).selectAll("div.item").transition().duration(t>=.9*D?4e3:2e3).ease(r).tween("rotateByStep",function(){var n=this,a=i(n),r=function(t,e){if(e<=I)return o(t,e);var n=(I-t)/(e-t);return function(i){return i>=n?o(0,e%I)((i-n)/(1-n)):o(t,I)(i/n)}}(n._currentAngle,n._currentAngle+t);return function(t){var i=r(t);n._currentAngle=i,a.style("transform",function(){return e._transformString(i)})}}).on("start end",function(){this._currentAngle=M(this._currentAngle)})}},{key:"resize",value:function(t,e){var n=this;n._size=[t,e],n._invalidateSizeFlag=!0,n.invalidateProperties()}},{key:"start",value:function(){this._invalidateStartFlag=!0,this.invalidateProperties()}},{key:"stop",value:function(){this._invalidateStopFlag=!0,this.invalidateProperties()}},{key:"dispose",value:function(){this._invalidateDisposeFlag=!0,this.invalidateProperties()}},{key:"onClick",value:function(t){this._itemClickHandle=t}},{key:"getActive",value:function(t){this._getActiveCallback=t}},{key:"domElement",get:function(){return this._domElement}},{key:"data",set:function(t){var e=this;e._data=t||[],e._invalidateDataFlag=!0,e.invalidateProperties()}},{key:"config",set:function(t){var e=this;void 0!==(t=t||{}).clickInteractive&&(e._clickInteractive=t.clickInteractive),void 0!==t.showTip&&(e._showTip=t.showTip),void 0!==t.itemSize&&0<t.itemSize.length&&(e._itemSize=[t.itemSize[0],t.itemSize[1]])}}]),n}(u),L=function(i){function a(t){var e;_(this,a);var i=x(e=S(this,A(a).call(this,t)));return i._root=n(),i.state={},e}return b(a,e),y(a,[{key:"render",value:function(){return t.createElement("div",{className:"rotate_component_ellipse",ref:this._root})}},{key:"setData",value:function(t){this._rp.data=t}},{key:"componentDidMount",value:function(){var t=this,e=t.props,n=e.onClick,i=e.onActiveChange,a=t._root.current,r=new N;r.config={clickInteractive:!0,showTip:!1,itemSize:[130,130]},r.resize(a.clientWidth,a.clientHeight),a.appendChild(r.domElement),r.start(),r.onClick(function(t){n&&n({source:"rotateIcon",data:t})}),r.getActive(function(t){i&&i(t)}),t._rp=r,a.addEventListener("mouseenter",function(){r.stop()}),a.addEventListener("mouseover",function(){r.stop()}),a.addEventListener("mouseleave",function(){r.start()})}},{key:"componentWillUnmount",value:function(){this._rp.dispose()}}]),a}(),W=Math.PI/180,B=function(t){function e(t){var n;return _(this,e),(n=S(this,A(e).call(this,t))).initialize(),n}return b(e,m),y(e,[{key:"_initLights",value:function(){}},{key:"_initObjects",value:function(){var t=new v(30,64,32),e=new f({map:(new d).load(Image_sphere),color:7138556,transparent:!0,opacity:3}),n=new p(t,e);n.position.x=-50,this._sphere1=n,this.addObject(n)}},{key:"_initFinally",value:function(){var t=this,e=t._option.cameraPosition||[0,0,100];if(function(t){return Array.isArray(t)&&0<t.length}(e)){t.camera.position.set.apply(t.camera.position,e);var n=t.controls;n.update(),n.enableZoom=!1,n.enablePan=!1,n.enableRotate=!1}t.renderer.setPixelRatio(1)}},{key:"render",value:function(){this._sphere1.rotation.y+=.5*W}}]),e}(),U=function(n){function i(t){var e;return _(this,i),(e=S(this,A(i).call(this,t))).state={},e}return b(i,e),y(i,[{key:"render",value:function(){var e=this,n=e.props,i=n.left,a=void 0===i?0:i,r=n.top,o=void 0===r?0:r;return t.createElement("div",{ref:function(t){return e.domElement=t},style:{width:"400px",height:"400px",position:"absolute",left:"".concat(a,"px"),top:"".concat(o,"px")}})}},{key:"componentDidMount",value:function(){var t=new B({cameraPosition:[-105.24930828744404,.42382248349296303,-1.6540524445440992]}),e=this.domElement;t.resize(e.clientWidth,e.clientHeight),e.appendChild(t.domElement),t.startRender(),this._env=t}},{key:"componentWillUnmount",value:function(){this._env&&this._env.stopRender()}}]),i}();export default(function(n){function i(t){var e;_(this,i),g(x(e=S(this,A(i).call(this,t))),"_rootStyle",{width:"100%",height:"100%",position:"absolute"});var n=x(e);return n._rotateClickHandle=n._rotateClickHandle.bind(n),n._rotateActiveChangeHandle=n._rotateActiveChangeHandle.bind(n),n.state={},e}return b(i,e),y(i,[{key:"render",value:function(){var e=this;return t.createElement("div",{style:e._rootStyle,className:"rotate_component_root"},t.createElement(U,{left:225,top:120}),t.createElement(P,{text:"运城农业",textStyle:{fontSize:50},style:{position:"absolute",left:"330px",top:"270px"}}),t.createElement(P,{text:"宏观发展概况",textStyle:{fontSize:30},style:{position:"absolute",left:"340px",top:"335px"}}),t.createElement(F,null),t.createElement(z,{wordShow:!1}),t.createElement(L,{onClick:e._rotateClickHandle,ref:function(t){return e._rotateElementsRef=t},onActiveChange:e._rotateActiveChangeHandle}))}},{key:"setData",value:function(t){this._rotateElementsRef.setData(t)}},{key:"_rotateClickHandle",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"_rotateActiveChangeHandle",value:function(t){this.props.onActiveChange&&this.props.onActiveChange(t)}}]),i}());
